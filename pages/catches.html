<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Catches - Pokemon Eclipse Wiki</title>
    <script src="../components/sidebar.js"></script>
    <script src="../components/header.js"></script>
    <script src="../components/footer.js"></script>
    <script src="../utils/luaConverter.js"></script>
    <link rel="stylesheet" href="../css/style.css" />
</head>
<script>
    let pokemons = null
    Promise.all([
        LuaConverter.convertFromLua('catches'),
        LuaConverter.convertFromLua('pokeballs')
    ]).then(([catches, loadedPokeballs]) => {
        pokemons = catches
        pokeballs = loadedPokeballs

        document.addEventListener('DOMContentLoaded', () => {
            const catchCards = document.getElementById('cards-container')

            Object.entries(pokemons).forEach(([key, value], index) => {
                const pokemonName = key.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
                const newCard = document.createElement('div')
                const pokeballsToPokemon = findPokeballsToPokemon(pokeballs, value)
                newCard.classList.add('pokemon-evolution-card')
                newCard.innerHTML = `
                            <img class="pokemon-icon"
                            src="https://img.pokemondb.net/sprites/home/normal/arceus.png" alt="Ícone de ${pokemonName}">
                            <p class="pokemon-name">${pokemonName}</p>
                            <div class="stone-cost"><span class="stone-quantity">Pontos de Catch: ${value.pontos}</span></div>
                            <p>Teto em Pokeballs:</p>
                            <div class="pokeballs-of-pokemon">
                            ${pokeballsToPokemon.map(pokeball => `<p>${pokeball.pokeball}: ${pokeball.quantidade}</p>`).join('')
                    }
                            </div>
                        `
                console.log(newCard)
                catchCards.appendChild(newCard)
            });
        })

        function findPokeballsToPokemon(pokeballs, pokemon) {
            let pokeballsToPokemon = []
            Object.entries(pokeballs).forEach(([key, pokeballValue]) => {
                if (pokeballValue.tipos.includes('todos') || pokemon.tipos.some(tipo => pokeballValue.tipos.includes(tipo))) {
                    pokeballsToPokemon.push({ pokeball: key.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '), quantidade: Math.ceil(pokemon.pontos / pokeballValue.pontos) })
                }
            });

            return pokeballsToPokemon
        }
    })

</script>

<body>
    <header id="main-header">
        <button id="menu-toggle" aria-label="Abrir menu de navegação">&#9776;</button>
        <h1>Pokemon Eclipse Wiki</h1>
    </header>

    <div id="overlay"></div>

    <div class="main-layout">
        <custom-sidebar></custom-sidebar>
        <!-- NÃO RETIRAR ESTE CARD MODAL ABAIXO -->
        <div class="pokemon-evolution-card" style="display: none;"><img class="pokemon-icon"
                src="https://img.pokemondb.net/sprites/home/normal/arceus.png" alt="Ícone de Arceus">
        </div>
        <main id="content">
            <section>
                <h2>Sistema de Catch</h2>

                <div class="wiki-item-image">
                    <img src="https://i.imgur.com/eEhQerP.png" alt="Imagem da Shiny Stone" />
                </div>

                <p>Nesta seção você encontra informações sobre o sistema de captura dos Pokémons mais relevantes do
                    jogo.</p>
                <div id="cards-container" class="evolution-cards-container">


                </div>

                <h2>Como Obter a Shiny Stone?</h2>
                <p>Existem diversas maneiras de conseguir uma Shiny Stone no jogo. As principais são:</p>
                <ul>
                    <li>Recompensa por completar a [Nome da Quest].</li>
                    <li>Chance de ser dropada ao derrotar o [Nome do Boss].</li>
                    <li>Prêmio obtido no baú da <a href="tower.html">Dimension Zone Tower</a>.</li>
                    <li>Pode ser comprada na loja do jogo por [Quantidade] de moedas.</li>
                </ul>
            </section>
        </main>
    </div>

    <custom-footer></custom-footer>

    <script src="../script/script.js"></script>
</body>

</html>
